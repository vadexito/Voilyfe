
<?php
    $list = '';
    $filterMonth = new Zend_Filter_NormalizedToLocalized(['date_format' => Zend_Date::MONTH_NAME]);
    $filterYear = new Zend_Filter_NormalizedToLocalized(['date_format' => Zend_Date::YEAR]);
    
    $monthPrev = null;
    $yearPrev = null;
    $eventsForFront = [];
    foreach ($this->events as $event)
    {
        $date = $event->date;
        $month = $date->format('n');
        $year = $date->format('Y');

        //we put a divider each month
        if (!($month === $monthPrev && $year === $yearPrev))
        {
            $dateNormalized = [
                'day'       => $date->format('d'),
                'month'     => $month,
                'year'      => $year
            ];
            $monthPrev = $month;
            $yearPrev = $year;
            
            $list .= '<li data-role="list-divider">'
                    .$filterMonth->filter($dateNormalized)
                    .' '.$filterYear->filter($dateNormalized).'</li>';
        }
        $list .= $this->event($event)->eventLine();
        $eventsForFront[]  = $this->event($event)->eventForFront();
        
    }
    
    $this->inlineScript()->setAllowArbitraryAttributes('true')
            ->offsetSetScript(
                    102,
                    'var lastEvents = '.Zend_Json::encode($eventsForFront).';'
                    ,'text/javascript',
                    ['noescape'=>'true','id' => 'last-events-list']
            );
?>
        
<ul data-role="listview" id="last-events-list-view">    
    <?php echo $list; ?>
</ul>